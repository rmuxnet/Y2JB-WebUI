<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y2JB - Repo Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style/toast.css') }}">
    <script src="{{ url_for('static', filename='toast.js') }}" defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        oled: { base: '#000000', surface: '#121212', border: '#2a2a2a' },
                        brand: { blue: '#00439c', light: '#0070d1' }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style/repo.css') }}">
    <script src="{{ url_for('static', filename='repos.js') }}" defer></script>
</head>
<body class="font-sans antialiased min-h-screen flex flex-col p-6 max-w-5xl mx-auto">

    <header class="flex items-center justify-between mb-8">
        <div class="flex items-center gap-4">
            <a href="/" class="surface border w-10 h-10 flex items-center justify-center rounded-full hover:bg-white/5 transition-colors hover:border-brand-light group">
                <i class="fa-solid fa-arrow-left group-hover:-translate-x-1 transition-transform"></i>
            </a>
            <h1 class="text-2xl font-bold tracking-tight">Repository Manager</h1>
        </div>
        <button onclick="openModal()" class="bg-gradient-to-r from-brand-blue to-brand-light hover:from-blue-600 hover:to-blue-500 text-white px-5 py-2.5 rounded-lg font-bold text-sm transition-all shadow-lg shadow-blue-500/20 hover:shadow-blue-500/30 border border-white/10">
            <i class="fa-solid fa-plus mr-2"></i> Add Repo
        </button>
    </header>

    <div class="surface border rounded-2xl shadow-xl mb-8 overflow-y-auto custom-scroll max-h-[600px] min-h-[300px] relative">
        <table class="w-full text-left text-sm border-collapse">
            <thead class="surface sticky top-0 z-20 uppercase text-xs font-bold tracking-wider shadow-md">
                <tr>
                    <th class="p-4 opacity-70">Filename (Key)</th>
                    <th class="p-4 opacity-70">Type</th>
                    <th class="p-4 opacity-70">Source Details</th>
                    <th class="p-4 text-right opacity-70">Actions</th>
                </tr>
            </thead>
            <tbody id="repoTable" class="divide-y divide-oled-border">
                </tbody>
        </table>
        <div id="loading" class="p-8 text-center opacity-50">Loading repositories...</div>
    </div>

    <details class="surface border rounded-2xl p-6 transition-all hover:border-brand-blue/30 shadow-sm group">
        <summary class="flex items-center justify-between cursor-pointer list-none select-none">
            <h3 class="text-lg font-bold flex items-center gap-2">
                <i class="fa-regular fa-circle-question text-brand-light"></i> 
                <span>Configuration Guide</span>
            </h3>
            <span class="w-8 h-8 flex items-center justify-center rounded-full bg-white/5 group-hover:bg-brand-blue/20 transition-colors">
                <i class="fa-solid fa-chevron-down text-xs transition-transform duration-300 group-open:rotate-180"></i>
            </span>
        </summary>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-sm mt-6 animate-fade-in">
            <div class="space-y-6">
                <div>
                    <h4 class="font-bold text-brand-light flex items-center gap-2 mb-2">
                        <i class="fa-brands fa-github"></i> GitHub Releases
                    </h4>
                    <p class="opacity-70 mb-3 leading-relaxed">
                        When using the <b>Release</b> type, the system checks the latest release of a repo. 
                        Since releases often contain multiple files (checksums, source code, multiple binaries), 
                        you must use the <b>Asset Pattern</b> to tell the system which file to grab.
                    </p>
                    
                    <div class="bg-black/40 p-4 rounded-lg border border-oled-border">
                        <p class="text-[10px] font-bold opacity-50 uppercase mb-2 tracking-wider">Asset Pattern Examples</p>
                        <ul class="space-y-3 text-xs font-mono">
                            <li class="flex flex-col gap-1">
                                <span class="opacity-60 font-sans">Exact Match:</span>
                                <span class="text-green-400">kstuff.elf</span>
                                <span class="text-[10px] opacity-40 font-sans">Use when the filename is always static.</span>
                            </li>
                            <li class="flex flex-col gap-1 border-t border-white/5 pt-2">
                                <span class="opacity-60 font-sans">Wildcards (Dynamic):</span>
                                <span class="text-brand-light">download-*.zip</span>
                                <span class="text-[10px] opacity-40 font-sans">Matches "download-1.3.zip", "download-v2.zip", etc.</span>
                            </li>
                            <li class="flex flex-col gap-1 border-t border-white/5 pt-2">
                                <span class="opacity-60 font-sans">Complex Wildcards:</span>
                                <span class="text-brand-light">*-ps5.elf</span>
                                <span class="text-[10px] opacity-40 font-sans">Matches anything ending in "-ps5.elf" (e.g., ftpsrv-ps5.elf).</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <div>
                    <h4 class="font-bold text-brand-light flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-link"></i> Direct URL
                    </h4>
                    <p class="opacity-70 text-xs">
                        Use this for files with a permanent static link (e.g., raw.githubusercontent.com files or direct website downloads).
                    </p>
                </div>
            </div>

            <div>
                <div class="flex items-center justify-between mb-2">
                    <h4 class="font-bold opacity-80 text-xs uppercase tracking-wide">Example Configuration</h4>
                    <span class="text-[10px] opacity-40">repos.json structure</span>
                </div>
                <div class="relative bg-black/40 rounded-xl border border-oled-border overflow-hidden">
                    <div class="flex items-center gap-1.5 px-4 py-2 border-b border-white/5 bg-white/5">
                        <div class="w-2.5 h-2.5 rounded-full bg-red-500/50"></div>
                        <div class="w-2.5 h-2.5 rounded-full bg-yellow-500/50"></div>
                        <div class="w-2.5 h-2.5 rounded-full bg-green-500/50"></div>
                    </div>
                    <pre class="p-4 overflow-x-auto text-[10px] font-mono leading-relaxed opacity-90 custom-scroll shadow-inner h-full max-h-[300px]">
{
    <span class="text-green-400">"lapse.js"</span>: {
        "type": "direct",
        "url": "https://raw.github.../lapse.js",
        "save_path": "payloads/js/lapse.js"
    },
    <span class="text-purple-400">"kstuff.elf"</span>: {
        "type": "release",
        "repo": "EchoStretch/kstuff",
        "asset_pattern": "kstuff.elf",
        "save_path": "payloads/kstuff.elf"
    },
    <span class="text-purple-400">"ftpsrv.elf"</span>: {
        "type": "release",
        "repo": "drakmor/ftpsrv",
        "asset_pattern": "ftpsrv-*.elf",
        "save_path": "payloads/ftpsrv-ps5.elf"
    },
    <span class="text-purple-400">"notify.elf"</span>: {
        "type": "release",
        "repo": "adel-ailane/ShadowMount",
        "asset_pattern": "notify.elf",
        "save_path": "payloads/notify.elf"
    }
}</pre>
                </div>
            </div>
        </div>
    </details>

    <div id="repoModal" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center z-50 backdrop-blur-sm transition-opacity">
        <div class="surface border rounded-2xl p-6 w-full max-w-md shadow-2xl transform transition-all scale-100">
            <h2 id="modalTitle" class="text-xl font-bold mb-4">Add Repository</h2>
            
            <input type="hidden" id="old-name-ref">

            <div class="space-y-4">
                <div>
                    <label class="block text-xs uppercase opacity-70 mb-1 font-bold">Outcome Filename</label>
                    <div class="flex items-center gap-2">
                        <span class="text-xs opacity-50 font-mono">payloads/</span>
                        <input type="text" id="repo-name" placeholder="example.elf" class="input-field flex-1 p-2 border rounded-lg font-mono text-brand-light">
                    </div>
                </div>
                
                <div>
                    <label class="block text-xs uppercase opacity-70 mb-1 font-bold">Source Type</label>
                    <select id="repo-type" onchange="toggleFields()" class="input-field w-full p-2 border rounded-lg">
                        <option value="direct">Direct URL</option>
                        <option value="release">GitHub Release Asset</option>
                    </select>
                </div>

                <div id="field-url" class="animate-fade-in">
                    <label class="block text-xs uppercase opacity-70 mb-1 font-bold">Direct Download URL</label>
                    <input type="text" id="repo-url" placeholder="https://example.com/payload.bin" class="input-field w-full p-2 border rounded-lg">
                </div>

                <div id="field-github" class="hidden space-y-4 animate-fade-in">
                    <div>
                        <label class="block text-xs uppercase opacity-70 mb-1 font-bold">GitHub Repo</label>
                        <input type="text" id="repo-github" placeholder="User/Project" class="input-field w-full p-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-xs uppercase opacity-70 mb-1 font-bold">Asset Pattern</label>
                        <input type="text" id="repo-pattern" placeholder="*.elf" class="input-field w-full p-2 border rounded-lg">
                        <p class="text-[10px] opacity-40 mt-1">Use wildcards (*) for version numbers. Ex: <span class="font-mono text-brand-light">app-*.zip</span></p>
                    </div>
                    <div>
                        <label class="block text-xs uppercase opacity-70 mb-1 font-bold">GitHub Token (Optional)</label>
                        <input type="password" id="repo-token" placeholder="ghp_xxxxxxxxxxxx" class="input-field w-full p-2 border rounded-lg font-mono">
                        <p class="text-[10px] opacity-40 mt-1">Required for private repositories. Create one in GitHub Developer Settings.</p>
                    </div>
                </div>
            </div>

            <div class="flex justify-end gap-3 mt-8 pt-4 border-t border-oled-border">
                <button onclick="closeModal()" class="px-4 py-2 hover:bg-white/5 rounded-lg text-sm font-bold transition-colors">Cancel</button>
                <button onclick="saveRepo()" class="px-6 py-2 bg-brand-blue hover:bg-brand-light rounded-lg text-sm font-bold transition-colors shadow-lg">Save</button>
            </div>
        </div>
    </div>
</body>
</html>